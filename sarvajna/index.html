<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarvajna Vachana Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@400;600&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Merriweather', serif;
            background-color: #f8fafc;
        }
        .kannada-text {
            font-family: 'Noto Sans Kannada', sans-serif;
            line-height: 1.8;
        }
    </style>
</head>
<body class="text-gray-800 antialiased min-h-screen flex flex-col">
    
    <header class="bg-white border-b border-gray-200 shadow-sm py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 tracking-tight">
                    <a href="index.html" class="hover:text-gray-600 transition-colors">Sarvajna Vachana Archive</a>
                </h1>
                <p class="text-sm text-gray-500 mt-2">A digital repository of 16th-century Kannada philosophical poet</p>
            </div>
            <div class="mt-4 md:mt-0 flex items-center space-x-3">
                <button id="order-toggle" class="whitespace-nowrap px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-gray-700 text-sm font-sans hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    Order: Sequential
                </button>
                <input id="search-input" type="text" placeholder="Search verses or themes..." class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm font-sans">
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full">
        <div id="archive-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Vachana cards will be injected here by JavaScript -->
        </div>
        <div id="pagination-container" class="mt-10 flex justify-center items-center space-x-6">
            <!-- Pagination controls will be injected here by JavaScript -->
        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 py-6 mt-auto">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-500 font-sans">
            <p>Open Source Archive compiled for linguistic preservation and study.</p>
        </div>
    </footer>

    <script>
        let originalVachanas = [];
        let allVachanas = [];
        let currentFilteredData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let isRandomized = false;

        function updateUrlState() {
            const url = new URL(window.location);
            url.searchParams.set('page', currentPage);
            window.history.pushState({}, '', url);
        }

        async function fetchAndRenderVachanas() {
            const urlParams = new URLSearchParams(window.location.search);
            const initialPage = parseInt(urlParams.get('page'), 10);
            if (!isNaN(initialPage) && initialPage > 0) {
                currentPage = initialPage;
            }

            try {
                const response = await fetch('uttangi.json');
                if (!response.ok) throw new Error("HTTP error " + response.status);
                originalVachanas = await response.json();
                
                allVachanas = [...originalVachanas];
                currentFilteredData = [...allVachanas];
            } catch (error) {
                console.error("External fetch failed. Please verify network access to the JSON corpus.", error);
                return;
            }

            renderCards();
        }

        function renderCards() {
            const container = document.getElementById('archive-container');
            container.innerHTML = '';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = currentFilteredData.slice(startIndex, endIndex);
            
            paginatedData.forEach(vachana => {
                const card = document.createElement('article');
                card.className = 'bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col transition-shadow hover:shadow-md';
                
                card.innerHTML = `
                    <div class="px-6 py-4 bg-gray-50 border-b border-gray-100 flex justify-between items-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 uppercase tracking-wide font-sans">
                            ${vachana.theme}
                        </span>
                        <span class="text-xs text-gray-400 font-mono">ID: ${String(vachana.id).padStart(4, '0')}</span>
                    </div>
                    <div class="p-6 flex-grow flex flex-col">
                        <p class="kannada-text text-xl text-gray-900 mb-6 font-semibold whitespace-pre-line">${vachana.kannada}</p>
                        <p class="text-sm text-gray-600 italic mb-6 flex-grow whitespace-pre-line">${vachana.transliteration}</p>
                        <div class="pt-4 border-t border-gray-100">
                            <p class="text-base text-gray-800 leading-relaxed font-medium">"${vachana.translation}"</p>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });

            renderPaginationControls();
        }

        function renderPaginationControls() {
            const container = document.getElementById('pagination-container');
            container.innerHTML = '';
            
            const totalPages = Math.ceil(currentFilteredData.length / itemsPerPage);
            
            if (totalPages <= 1) return;

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = currentPage === 1;
            prevBtn.className = `px-4 py-2 border rounded-md text-sm font-sans focus:outline-none focus:ring-2 focus:ring-indigo-500 ${currentPage === 1 ? 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}`;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateUrlState();
                    renderCards();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            const pageInfo = document.createElement('span');
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            pageInfo.className = 'text-sm text-gray-600 font-sans font-medium';

            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.className = `px-4 py-2 border rounded-md text-sm font-sans focus:outline-none focus:ring-2 focus:ring-indigo-500 ${currentPage === totalPages ? 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}`;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateUrlState();
                    renderCards();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            container.appendChild(prevBtn);
            container.appendChild(pageInfo);
            container.appendChild(nextBtn);
        }

        function filterData() {
            const query = document.getElementById('search-input').value.toLowerCase();
            currentFilteredData = allVachanas.filter(vachana => 
                vachana.theme.toLowerCase().includes(query) ||
                vachana.translation.toLowerCase().includes(query) ||
                vachana.transliteration.toLowerCase().includes(query) ||
                vachana.kannada.includes(query)
            );
        }

        document.getElementById('order-toggle').addEventListener('click', (event) => {
            isRandomized = !isRandomized;
            event.target.textContent = isRandomized ? 'Order: Random' : 'Order: Sequential';
            
            if (isRandomized) {
                allVachanas = [...originalVachanas];
                for (let i = allVachanas.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allVachanas[i], allVachanas[j]] = [allVachanas[j], allVachanas[i]];
                }
            } else {
                allVachanas = [...originalVachanas];
            }
            
            filterData();
            currentPage = 1;
            updateUrlState();
            renderCards();
        });

        document.getElementById('search-input').addEventListener('input', () => {
            filterData();
            currentPage = 1;
            updateUrlState();
            renderCards();
        });

        document.addEventListener('DOMContentLoaded', fetchAndRenderVachanas);
    </script>
</body>
</html>
