<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarvajna Vachana Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@400;600&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Merriweather', serif;
            background-color: #f8fafc;
        }
        .kannada-text {
            font-family: 'Noto Sans Kannada', sans-serif;
            line-height: 1.8;
        }
    </style>
</head>
<body class="text-gray-800 antialiased min-h-screen flex flex-col">
    
    <header class="bg-white border-b border-gray-200 shadow-sm py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 tracking-tight">
                    <a href="index.html" class="hover:text-gray-600 transition-colors">Sarvajna Vachana Archive</a>
                </h1>
                <p class="text-sm text-gray-500 mt-2">A digital repository of 16th-century Kannada philosophical poetry</p>
                <nav class="mt-4 flex space-x-6 text-sm font-sans font-medium">
                    <a href="#" id="nav-archive" class="text-indigo-600 hover:text-indigo-800 transition-colors">Archive</a>
                    <a href="#about" id="nav-about" class="text-gray-500 hover:text-gray-900 transition-colors">About</a>
                </nav>
            </div>
            <div id="archive-controls" class="mt-4 md:mt-0 flex items-center space-x-3">
                <button id="order-toggle" class="whitespace-nowrap px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-gray-700 text-sm font-sans hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    Order: Random
                </button>
                <input id="search-input" type="text" placeholder="Search verses or themes..." class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm font-sans">
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full">
        <div id="archive-view">
            <div id="archive-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Vachana cards will be injected here by JavaScript -->
            </div>
            <div id="pagination-container" class="mt-10 flex justify-center items-center space-x-6">
                <!-- Pagination controls will be injected here by JavaScript -->
            </div>
        </div>

        <div id="about-view" class="hidden bg-white rounded-xl shadow-sm border border-gray-100 p-8 md:p-12 text-gray-800 leading-relaxed">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 font-sans">About Sarvajna</h2>
            <p class="mb-6">Sarvajna ("The All Knowing") was a sixteenth-century rationalist, philosopher and poet wandering within the Kannada-speaking regions in South India. He is historically recognised for utilising the "tripadi", a precise three-line metrical structure, to deliver concentrated observations on sociology, ethics, and pragmatic survival. Rather than engaging in abstract theological discourse, his compositions functioned as direct empirical critiques of religious hypocrisy, caste stratification, and resource inequality. His identity remains partially obscured by the oral tradition that preserved his work, leading scholars to conclude that the name functioned as both a personal signature and a collective pseudonym adopted by subsequent generations of wandering moralists. The persistence of his verses within the cultural memory is attributed to their structural rhythm and the unadorned accuracy of their social commentary. The triplets or vachanas capture the zeitgeist in Kannada-speaking regions trying to overcome the caste system with rationalism, and is brimming with empathy, wit and humour. It continues to live in the culture of Kannadigas. </p>
            <h2 class="text-2xl font-bold text-gray-900 mb-6 font-sans">The Archival Methodology</h2>
            <p>This archival initiative aims to digitally preserve the historically authenticated corpus of Sarvajna's work. The main source for the archiving is based on the seminal research carried out by Channappa Uttangi, "Sarvajnana VachanagaLu" (1927) which documents more than 2000 vachanas. OCR-extracted text and scanned PDF available on <a href="https://archive.org/details/bmshri.sarvagnavachanag0000chan" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 underline transition-colors">archive.org</a> are used as the primary sources. I verify the OCR-extracted text with the scanned PDF, and adjust the transcribed vachanas. Then, these are input to Google Gemini for transliteration and translation. I verify the translation again, and then input the three tuple (vachana, transliteration, translation) into a <a href="https://github.com/raghavian/raghavian.github.io/blob/master/sarvajna/uttangi.json" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 underline transition-colors">json</a> file which is parsed on the website.
</p>
          <p> -- ರಾಘವೇಂದ್ರ</p>
        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 py-6 mt-auto">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-500 font-sans">
            <p>Open Source Archive compiled from public domain. Maintained by Raghavendra Selvan. 2026.</p>
        </div>
    </footer>

    <script>
        let originalVachanas = [];
        let allVachanas = [];
        let currentFilteredData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let isRandomized = true;

        function updateUrlState() {
            const url = new URL(window.location);
            url.searchParams.set('page', currentPage);
            window.history.pushState({}, '', url);
        }

        async function fetchAndRenderVachanas() {
            const urlParams = new URLSearchParams(window.location.search);
            const initialPage = parseInt(urlParams.get('page'), 10);
            if (!isNaN(initialPage) && initialPage > 0) {
                currentPage = initialPage;
            }

            try {
                const response = await fetch('uttangi.json');
                if (!response.ok) throw new Error("HTTP error " + response.status);
                originalVachanas = await response.json();
                
                allVachanas = [...originalVachanas];
                if (isRandomized) {
                    for (let i = allVachanas.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [allVachanas[i], allVachanas[j]] = [allVachanas[j], allVachanas[i]];
                    }
                }
                currentFilteredData = [...allVachanas];
            } catch (error) {
                console.error("External fetch failed. Please verify network access to the JSON corpus.", error);
                return;
            }

            renderCards();
        }

        function renderCards() {
            const container = document.getElementById('archive-container');
            container.innerHTML = '';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = currentFilteredData.slice(startIndex, endIndex);
            
            paginatedData.forEach(vachana => {
                const card = document.createElement('article');
                card.className = 'bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col transition-shadow hover:shadow-md';
                
                card.innerHTML = `
                    <div class="px-6 py-4 bg-gray-50 border-b border-gray-100 flex justify-between items-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 uppercase tracking-wide font-sans">
                            ${vachana.theme}
                        </span>
                        <span class="text-xs text-gray-400 font-mono">ID: ${String(vachana.id).padStart(4, '0')}</span>
                    </div>
                    <div class="p-6 flex-grow flex flex-col">
                        <p class="kannada-text text-xl text-gray-900 mb-6 font-semibold whitespace-pre-line">${vachana.kannada}</p>
                        <p class="text-sm text-gray-600 italic mb-6 flex-grow whitespace-pre-line">${vachana.transliteration}</p>
                        <div class="pt-4 border-t border-gray-100">
                            <p class="text-base text-gray-800 leading-relaxed font-medium">"${vachana.translation}"</p>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });

            renderPaginationControls();
        }

        function renderPaginationControls() {
            const container = document.getElementById('pagination-container');
            container.innerHTML = '';
            
            const totalPages = Math.ceil(currentFilteredData.length / itemsPerPage);
            
            if (totalPages <= 1) return;

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = currentPage === 1;
            prevBtn.className = `px-4 py-2 border rounded-md text-sm font-sans focus:outline-none focus:ring-2 focus:ring-indigo-500 ${currentPage === 1 ? 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}`;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateUrlState();
                    renderCards();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            const pageInfo = document.createElement('span');
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            pageInfo.className = 'text-sm text-gray-600 font-sans font-medium';

            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.className = `px-4 py-2 border rounded-md text-sm font-sans focus:outline-none focus:ring-2 focus:ring-indigo-500 ${currentPage === totalPages ? 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}`;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateUrlState();
                    renderCards();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            container.appendChild(prevBtn);
            container.appendChild(pageInfo);
            container.appendChild(nextBtn);
        }

        function filterData() {
            const query = document.getElementById('search-input').value.toLowerCase();
            currentFilteredData = allVachanas.filter(vachana => 
                vachana.theme.toLowerCase().includes(query) ||
                vachana.translation.toLowerCase().includes(query) ||
                vachana.transliteration.toLowerCase().includes(query) ||
                vachana.kannada.includes(query)
            );
        }

        document.getElementById('order-toggle').addEventListener('click', (event) => {
            isRandomized = !isRandomized;
            event.target.textContent = isRandomized ? 'Order: Random' : 'Order: Sequential';
            
            if (isRandomized) {
                allVachanas = [...originalVachanas];
                for (let i = allVachanas.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allVachanas[i], allVachanas[j]] = [allVachanas[j], allVachanas[i]];
                }
            } else {
                allVachanas = [...originalVachanas];
            }
            
            filterData();
            currentPage = 1;
            updateUrlState();
            renderCards();
        });

        document.getElementById('search-input').addEventListener('input', () => {
            filterData();
            currentPage = 1;
            updateUrlState();
            renderCards();
        });

        function switchView(viewName) {
            const archiveView = document.getElementById('archive-view');
            const aboutView = document.getElementById('about-view');
            const archiveControls = document.getElementById('archive-controls');
            const navArchive = document.getElementById('nav-archive');
            const navAbout = document.getElementById('nav-about');

            if (viewName === 'about') {
                archiveView.classList.add('hidden');
                archiveControls.classList.add('hidden');
                aboutView.classList.remove('hidden');
                
                navArchive.classList.remove('text-indigo-600', 'hover:text-indigo-800');
                navArchive.classList.add('text-gray-500', 'hover:text-gray-900');
                navAbout.classList.remove('text-gray-500', 'hover:text-gray-900');
                navAbout.classList.add('text-indigo-600', 'hover:text-indigo-800');
            } else {
                archiveView.classList.remove('hidden');
                archiveControls.classList.remove('hidden');
                aboutView.classList.add('hidden');
                
                navArchive.classList.remove('text-gray-500', 'hover:text-gray-900');
                navArchive.classList.add('text-indigo-600', 'hover:text-indigo-800');
                navAbout.classList.remove('text-indigo-600', 'hover:text-indigo-800');
                navAbout.classList.add('text-gray-500', 'hover:text-gray-900');
            }
        }

        document.getElementById('nav-archive').addEventListener('click', (e) => {
            e.preventDefault();
            switchView('archive');
            window.history.pushState({}, '', window.location.pathname + window.location.search);
        });

        document.getElementById('nav-about').addEventListener('click', (e) => {
            e.preventDefault();
            switchView('about');
            window.history.pushState({}, '', '#about');
        });

        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.hash === '#about') {
                switchView('about');
            }
            fetchAndRenderVachanas();
        });
    </script>
</body>
</html>
